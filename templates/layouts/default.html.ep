<!doctype html>

<meta charset="utf-8">
<title>HULKs Recruiting 2019</title>
<link rel="stylesheet" href="recruiting.css" type="text/css">

<main>
  <%= content %>
</main>

<script src="ace-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
  var resultsLoad = (evt) => {
      var status = evt.target.status;

      if (status == 200) {
          document.querySelector(".code-output").innerText =
              evt.target.responseText;

          plotBall();
      } else {
          alert(`Server returned status ${status}! See console for details.`);
          console.log(evt.target);
      }
  };

  var requestError = (evt) => {
      alert('Request resulted in an error. See console for details.');
      console.log(evt.target);
  };

  var requestTimeout = (evt) => {
      alert('Request resulted in a timeout. See console for details.');
      console.log(evt.target);
  };

  var ballLoad = (evt) => {
      var status = evt.target.status;

      if (status == 200) {
          console.log(evt.target.responseText);

          var cursor = document.querySelector(".cursor");
          cursor.style.opacity = "1";

          var y, x;
          [y, x] = evt.target.responseText.split(",");

          cursor.style.top = `${y}px`;
          cursor.style.left = `${x}px`;
      } else {
          alert(`Server returned status ${status}! See console for details.`);
          console.log(evt.target);
      }
  };

  var plotBall = () => {
      console.log("Now plotting ball...");

      var req = new XMLHttpRequest();
      req.addEventListener("load", ballLoad);
      req.addEventListener("error", requestError);
      req.addEventListener("timeout", requestTimeout);
      req.open("GET", "/ball");
      req.send();
  };

  window.addEventListener("load", () => {
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/github");
      editor.session.setMode("ace/mode/python");

      var runForm = document.querySelector("form");
      var runButton = document.querySelector("button");

      runButton.addEventListener("click", (evt) => {
          evt.preventDefault();

          var fd = new FormData(runForm);
          fd.append("code-input", editor.getValue());

          var req = new XMLHttpRequest();
          req.addEventListener("load", resultsLoad);
          req.addEventListener("error", requestError);
          req.addEventListener("timeout", requestTimeout);
          req.open("POST", "/run");
          req.send(fd);
      });

  });
</script>
