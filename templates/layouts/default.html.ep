<!doctype html>

<meta charset="utf-8">
<title>HULKs Recruiting 2019</title>
<link rel="stylesheet" href="recruiting.css" type="text/css">

<main>
  <%= content %>
</main>

<script src="ace-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
  var resultsLoad = (evt) => {
      var status = evt.target.status;

      if (status == 200) {
          document.querySelector(".code-output").innerText =
              evt.target.responseText;
      } else {
          alert(`Server returned status ${status}! See console for details.`);
          console.log(evt.target);
      }
  };

  var resultsError = (evt) => {
      alert('Request resulted in an error. See console for details.');
      console.log(evt.target);
  };

  var resultsTimeout = (evt) => {
      alert('Request resulted in a timeout. See console for details.');
      console.log(evt.target);
  };

  window.addEventListener("load", () => {
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/github");
      editor.session.setMode("ace/mode/python");

      var runForm = document.querySelector("form");
      var runButton = document.querySelector("button");

      runButton.addEventListener("click", (evt) => {
          evt.preventDefault();

          var fd = new FormData(runForm);
          fd.append("code-input", editor.getValue());

          var req = new XMLHttpRequest();
          req.addEventListener("load", resultsLoad);
          req.addEventListener("error", resultsError);
          req.addEventListener("timeout", resultsTimeout);
          req.open("POST", "/run");
          req.send(fd);
      });

  });
</script>
